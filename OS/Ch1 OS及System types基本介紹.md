## computer System Structure
### 電腦的組成
1. 硬體（Hardware）
	- 中央處理器（CPU, Central Processing Unit）：CPU是電腦的核心運算和控制單元，負責執行指令和處理數據。它由控制單元（Control Unit）、算術邏輯單元（ALU, Arithmetic Logic Unit）和寄存器（Registers）組成。
	- 記憶體（Memory）：記憶體用來存儲數據和指令。主要分為兩類：
		- 主記憶體（Primary Memory）：如隨機存取記憶體（RAM, Random Access Memory），用來存儲正在使用的數據和程序。
		- 輔助記憶體（Secondary Memory）：如硬碟、固態硬碟（SSD），用來長期存儲數據和程序。
	- 輸入/輸出裝置（I/O Devices）：包括鍵盤、滑鼠、顯示器、打印機等，用於數據的輸入和輸出。
	- 母板（Motherboard）：所有硬體組件的連接平台，包括CPU插槽、記憶體插槽、I/O介面等。
	- 匯流排（Bus）：數據傳輸的通道，用於不同硬體組件之間的通信。主要有數據匯流排、地址匯流排和控制匯流排。
2. 軟體（Software）
	- 系統軟體（System Software）：管理和控制硬體資源，提供基本功能，使應用軟體能夠運行。主要包括：
		- 操作系統（Operating System, OS）：如Windows、macOS、Linux，負責硬體管理、檔案管理、記憶體管理和進程管理等。
		- 驅動程式（Drivers）：使操作系統能夠與硬體設備進行通信。
	- 應用軟體（Application Software）：專為執行特定任務或提供特定功能而設計的軟體，如辦公軟體、圖像編輯軟體、遊戲等。
3. 韌體（Firmware）
	- 韌體是嵌入在硬體設備中的低層次軟體，用於控制硬體的基本操作。BIOS（基本輸入輸出系統）是最常見的韌體之一，它在啟動時初始化並測試系統硬體。
4. 資料（Data）
	- 資料是電腦系統處理的核心內容，包含用戶輸入的信息、系統生成的數據以及軟體程序中使用的各類數據。資料的存儲和處理是電腦系統的主要功能之一。
### user和computer System Structure之間的關係
1. 用戶 -> 命令解釋器（User -> Command Interpreter）
	- 定義
		命令解釋器：又稱Shell，是一種特殊的應用程序，負責接收用戶輸入的命令並將其轉換為操作系統可以理解和執行的操作。常見的命令解釋器包括Unix/Linux中的Bash、Windows中的Command Prompt和PowerShell。
	- 互動過程
		1. 用戶輸入命令：用戶在命令行界面輸入命令。
		2. 命令解釋器解析命令：命令解釋器將用戶輸入的命令解析為一系列操作。
		3. 執行命令：命令解釋器通過系統調用向操作系統請求相應的服務，如啟動程序、訪問文件系統等。
		4. 返回結果：操作系統執行命令後將結果返回給命令解釋器，命令解釋器再將結果展示給用戶。
2. 用戶程序 -> 系統調用（User Program -> System Call）
	- 定義
		- 用戶程序：由用戶編寫和運行的應用程序。
		- 系統調用：用戶程序向操作系統內核請求服務的接口。這些服務包括文件操作、進程控制、記憶體管理、網絡通信等。
	- 互動過程
		1. 用戶程序發出請求：用戶程序中包含的代碼會發出系統調用，請求操作系統提供特定的服務。例如，讀取文件、創建新進程等。
		2. 系統調用接口：操作系統提供的系統調用接口會接收這些請求，並根據請求的類型執行相應的操作。
		3. 操作系統內核處理請求：內核負責執行實際的操作，如文件讀寫、進程調度、內存分配等。
		4. 返回結果：內核將操作結果通過系統調用接口返回給用戶程序，用戶程序接收到結果後繼續執行。
### Kernel（內核）
#### 介紹
- 資源管理：
	- 處理器管理：負責調度CPU時間，分配給不同的進程和線程。
	- 記憶體管理：管理物理和虛擬記憶體，包括內存分配和釋放。
	- 設備管理：控制和協調各種硬體設備的操作，如磁盤、網卡等。
	- 文件系統管理：提供文件存取和管理功能。
- 系統調用接口：
	為應用程序提供與硬體交互的標準接口，允許應用程序通過系統調用請求內核服務。
- 安全和穩定性：
	- 實現進程隔離和訪問控制，保護系統和用戶數據的安全。
	- 提供錯誤處理機制和系統恢復功能，保證系統穩定運行。
#### Kernel Resident in Memory（常駐內存）
內核常駐於內存的原因在於其需要即時響應系統和應用程序的請求。
1. 高效性：
	內核需要快速響應各種系統調用和中斷請求。如果內核不常駐內存，則每次需要時都必須從輔助存儲裝置（如硬盤）讀取，這會導致大量的延遲，影響系統性能。
2. 穩定性：
	內核管理系統的所有資源和設備，任何延遲或故障都可能導致整個系統崩潰。常駐內存可以確保內核始終可用，降低崩潰風險。
3. 安全性：
	內核常駐內存並且受到保護模式的保護，可以防止用戶進程意外或惡意地修改內核代碼或數據，從而提高系統的安全性。
#### 通常不使用virtual memory（虛擬內存）的原因
1. 性能考量：
	虛擬內存涉及頁面交換（paging），這是一個相對較慢的過程。內核需要快速且即時地響應各種請求，如果內核代碼和數據在虛擬內存中，則可能導致頻繁的頁面錯誤（page fault），從而嚴重影響系統性能。
2. 穩定性和可靠性：
	內核負責系統的核心管理功能，如記憶體管理、進程調度等。這些功能需要穩定且即時的運行。如果內核使用虛擬內存，內核代碼或數據被交換出內存時，可能導致系統運行的不穩定，甚至崩潰。
3. 簡化設計和實現：
	內核使用虛擬內存會複雜化其設計，因為內核必須處理自己的頁面交換和記憶體管理邏輯，這增加了內核的複雜性和潛在的錯誤風險。通過常駐內存，內核設計可以更加簡潔和可靠。
4. 資源競爭：
	如果內核使用虛擬內存，內核和用戶進程將會競爭有限的物理內存資源。這可能導致系統性能下降，特別是在內存不足的情況下。
![[Pasted image 20240708061457.png]]
## OS的role
1. 資源管理(資源管理者)
	操作系統負責管理計算機系統的所有資源，包括CPU、內存、磁碟、網絡設備等。這些資源的管理包括：
	- 處理器管理：操作系統負責調度CPU時間，分配給不同的進程和線程，確保各個程序能夠公平且高效地使用CPU資源。
	- 記憶體管理：操作系統管理物理內存和虛擬內存，分配和釋放內存空間，並處理內存保護和共享。
	- 存儲管理：操作系統管理磁碟和其他存儲設備，提供文件系統來組織和存儲數據，並確保數據的可靠性和安全性。
	- 設備管理：操作系統控制和協調所有輸入輸出設備的操作，如鍵盤、滑鼠、打印機、網絡設備等。
2. 系統調用接口(服務提供者)
	操作系統提供一組系統調用（System Call）接口，允許應用程序請求操作系統執行各種服務。系統調用包括文件操作（如打開、讀取、寫入文件）、進程控制（如創建和終止進程）、設備操作等。
	- 進程管理：操作系統負責創建、調度和終止進程，並提供進程間通信（IPC）機制。進程管理包括：
	- 進程調度：確定哪些進程應該在何時運行，以優化CPU使用率和系統性能。
	- 進程同步：處理多個進程之間的協調，以避免競爭條件和死鎖。
	- 進程通信：提供進程之間的數據交換和信息傳遞機制。
3. 文件系統管理
	操作系統提供文件系統，用於存儲、檢索和管理數據。文件系統管理包括：
	- 文件操作：如創建、刪除、打開、關閉、讀取和寫入文件。
	- 目錄管理：組織文件和目錄的層次結構，便於用戶和應用程序訪問。
	- 存儲分配：管理磁碟空間的分配和回收，確保數據有效存儲和訪問。
4. 用戶接口
	操作系統提供用戶接口（User Interface），允許用戶與計算機系統進行交互。主要包括：
	- 命令行界面（CLI）：如Unix/Linux的Bash Shell和Windows的Command Prompt，允許用戶通過命令輸入與系統交互。
	- 圖形用戶界面（GUI）：如Windows、macOS、Linux的圖形桌面環境，提供直觀的圖形化操作界面。
5. 安全和保護(安全保護者)
	操作系統負責系統安全和資源保護，防止未授權的訪問和數據破壞。安全和保護功能包括：
	- 身份驗證：確認用戶身份的機制，如登錄名和密碼。
	- 授權：控制用戶和進程對系統資源的訪問權限。
	- 加密：保護數據在傳輸和存儲過程中的機密性。
	- 防火牆和防病毒：保護系統免受網絡攻擊和惡意軟體侵害。
6. 錯誤檢測和恢復
	操作系統負責檢測和處理系統錯誤，並提供恢復機制以確保系統穩定運行。這包括：
	- 錯誤檢測：監控系統運行狀態，檢測硬件故障、軟件錯誤和其他異常情況。
	- 錯誤恢復：實施錯誤處理和恢復策略，如重新啟動故障進程、回滾數據庫操作等。
## 多程式系統（Multiprogramming System）
### 定義
多程式系統是一種操作系統技術，允許多個程序（進程）同時存在於內存中並共享計算機資源，如CPU和內存。這種技術的目的是提高系統資源的利用率和計算效率，通過在等待I/O操作的程序和其他準備執行的程序之間切換，來最大化CPU的使用。
### 作法
1. 進程管理：
	- 進程創建和終止：操作系統必須能夠動態地創建和終止進程。每個進程都有自己獨立的地址空間和系統資源。
	- 進程控制塊（PCB）：每個進程在內核中都有一個進程控制塊，包含進程的狀態、程序計數器、寄存器內容、內存分配信息等。
2. CPU調度：
	- 長期調度（作業調度）：決定哪些作業（job）應該被引入內存，並開始它們的進程。這通常在作業隊列（job queue）和準備隊列（ready queue）之間進行。
	- 短期調度（進程調度）：在準備隊列中的進程之間選擇一個進程分配CPU時間。常見的調度算法包括先來先服務（FCFS）、最短作業優先（SJF）、輪轉法（Round Robin）等。
	- 中期調度：部分系統可能實現中期調度，用於內存的臨時分配和回收（即交換）。
3. 內存管理：
	- 分區分配：內存被劃分為若干固定或可變大小的分區，每個分區可以分配給一個進程。這樣可以確保多個進程同時駐留在內存中。
	- 虛擬內存：使用分頁（paging）或分段（segmentation）技術，允許進程使用比實際物理內存更大的地址空間。
4. I/O管理：
	- I/O多路復用：操作系統能夠管理多個I/O請求，並在I/O操作進行期間允許CPU繼續處理其他進程。這樣可以有效地減少CPU閒置時間。
	- 緩衝區管理：在進程和設備之間使用緩衝區來平衡速度差異，提高I/O效率。
5. 中斷處理：
	- 硬中斷：當I/O設備完成操作或發生錯誤時，發送中斷信號給CPU。操作系統必須快速響應中斷，保存當前進程狀態並處理中斷請求。
	- 軟中斷：由程序或操作系統內核產生，用於處理內部事件和系統調用。
### 優缺點
1. 多程式系統的優點
	- 提高CPU利用率：通過在多個進程之間切換，CPU能夠更高效地被使用，減少閒置時間。
	- 增強系統吞吐量：多個進程同時駐留在內存中，可以同時進行I/O和計算操作，提高整體系統的吞吐量。
	- 改善用戶響應時間：多程式系統能夠同時處理多個用戶請求，縮短用戶等待時間，提高系統響應速度。
2. 多程式系統的挑戰
	- 資源競爭：多個進程競爭有限的系統資源，可能導致資源爭用和死鎖。
	- 進程同步和通信：確保多個進程之間能夠正確地同步和通信，以避免數據不一致和競爭條件。
	- 內存管理：有效地分配和回收內存，並處理內存保護和共享問題。
### CPU Idle
CPU Idle 是指中央處理器（CPU）處於閒置狀態，即沒有任何指令需要執行。這種情況可能發生在以下幾種情況下：
- 等待I/O操作：當程序進行I/O操作（如讀取文件或網絡數據）時，CPU可能需要等待這些操作完成，這段時間內CPU沒有其他任務需要處理。
- 缺乏準備好的進程：如果所有進程都處於等待狀態，無法獲取CPU時間片，CPU將處於閒置狀態。
- 系統空閒：當操作系統沒有任何需要處理的進程或任務時，CPU會處於閒置狀態。
### Multiprogramming Degree
Multiprogramming Degree 是指在一個多程式系統中，同時駐留在內存中並處於就緒狀態的進程數量。這個數量直接影響到系統的資源利用率和性能。
1. 影響因素有: 
	- 內存大小：內存越大，可以同時駐留的進程越多。
	- I/O性能：高效的I/O系統可以更快地完成I/O操作，減少進程等待時間，增加多程式度。
	- CPU調度算法：先進的調度算法可以更高效地分配CPU時間，提升多程式度。
	- 進程特性：進程的I/O密集度和CPU密集度會影響系統的多程式度。
2. 重要性
	增加多程式度可以提高CPU利用率，減少CPU閒置時間，從而提高系統吞吐量和性能。然而，過高的多程式度可能導致過度的資源競爭和上下文切換，降低系統性能。
### 多個進程同時執行的方式
#### 單CPU環境：併發執行（Concurrent Execution）
在單CPU系統中，多個進程同時執行是通過併發執行技術來實現的。雖然從宏觀上看似多個進程在同時運行，但實際上在任意時刻，CPU只能執行一個進程。併發執行依賴於快速的上下文切換和時間共享機制。以下是實現併發執行的關鍵技術：
1. 時間共享（Time Sharing）：
	- 時間片（Time Slice）：操作系統為每個進程分配一個固定的時間片。在時間片結束時，CPU會進行上下文切換到另一個進程。這樣每個進程都能周期性地獲得CPU時間。
	- 上下文切換（Context Switching）：在進程之間切換時，操作系統需要保存當前進程的狀態（如寄存器、程序計數器、內存分配等），並加載下一個進程的狀態。這一過程由調度器（Scheduler）控制。
2. 多任務（Multitasking）：
	多任務操作系統允許多個進程在內存中同時存在，並交替獲得CPU時間。這種交替執行的方式使得多個進程看起來像是並行運行。
3. 優先級調度：
	操作系統可以根據進程的優先級來分配CPU時間。優先級高的進程可以獲得更多的CPU時間或更頻繁地被調度。
#### 多CPU環境：並行執行（Parallel Execution）
在多CPU或多核系統中，多個進程可以真正同時運行，這稱為並行執行。每個CPU或核心可以獨立地執行不同的進程或線程。以下是實現並行執行的關鍵技術：
1. 對稱多處理（SMP, Symmetric Multiprocessing）：
	- 所有CPU共享同一內存和I/O資源，操作系統可以將進程和線程分配給任何可用的CPU。這種方式下，每個CPU都能平等地執行任務。
	- 調度器負責將進程分配給不同的CPU，以最大化資源利用率和系統性能。
2. 非對稱多處理（AMP, Asymmetric Multiprocessing）：
	各個CPU有不同的角色和功能，一般只有主CPU負責操作系統內核的工作，而其他CPU專門用於執行特定的任務或應用程序。
3. 多核處理器（Multicore Processor）：
	單個物理處理器包含多個處理核心，每個核心可以獨立執行進程和線程，實現真正的並行處理。多核處理器在現代計算機系統中非常普遍。
4. 超執行緒（Hyper-Threading）：
	這是一種由Intel引入的技術，允許每個物理核心作為兩個邏輯核心運行。這樣，單個物理核心可以同時執行多個執行緒，進一步提高並行性和性能。
![[Pasted image 20240708064019.png]]
## Time-Sharing System aka. 多任務系統（Multitasking System）

### 定義
允許多個用戶或多個任務共享計算機資源（如CPU、內存和I/O設備），並讓每個用戶或任務感覺到他們擁有獨佔的系統資源。
操作系統通過將CPU時間分成小片段，稱為時間片（time slice），並分配給每個進程，使得多個進程可以在短時間內快速交替執行。這種快速的切換使得每個進程看起來像是同時運行，實現了多任務的效果。
It's a logical extension of Multiprogramming System
### 作法
1. 進程管理：
	創建和管理多個進程，每個進程有自己獨立的地址空間和資源。操作系統維護進程控制塊（PCB），其中包含進程的狀態、寄存器內容、程序計數器等。
2. CPU調度：
	- 使用調度算法分配CPU時間。常見的調度算法包括先來先服務（FCFS）、最短作業優先（SJF）、優先級調度、圓形時間片（Round Robin）等。
	- 圓形時間片調度（Round Robin Scheduling）：是時間共享系統中最常用的調度算法，將CPU時間均分成時間片，按循環順序分配給每個進程。
3. 上下文切換：
	在進程之間切換時，操作系統保存當前進程的狀態並加載下一個進程的狀態。上下文切換需要低延遲，以最小化切換開銷。
4. 內存管理：
	- 使用分頁（paging）或分段（segmentation）技術，實現虛擬內存，讓進程感覺擁有獨立的內存空間。
	- 管理內存分配和回收，確保內存不被浪費和避免碎片化。
5. I/O管理：
	- 實現I/O多路復用技術，使得多個進程可以同時發起I/O請求，而不必等待I/O操作完成。
	- 使用緩衝區和中斷處理技術，提高I/O操作的效率。
6. 同步與通信：
	- 提供進程間通信（IPC）機制，如消息隊列、管道、共享內存等，讓進程之間能夠協同工作。
	- 實現同步機制，如信號量、互斥鎖，以防止競爭條件和死鎖。
### CPU Switching at High Frequency
1. 快速上下文切換：
	操作系統能夠在進程之間迅速保存和恢復上下文，包括程序計數器、寄存器內容、內存狀態等。
2. 時間片輪轉調度：
	高頻率切換常與時間片輪轉調度算法（Round Robin Scheduling）一起使用，每個進程在固定時間片內獲得CPU，然後切換到下一個進程。
3. 高響應性：
	通過高頻率切換，系統能夠更快地響應用戶請求和外部事件，提升用戶體驗。
### 適用於User-Interactive Environment/Computing
### 虛擬內存技術（Virtual Memory Technology）
通過將內存地址虛擬化，提供了一個連續的、邏輯上的內存空間給應用程序，使其感覺擁有足夠的內存資源。
1. 地址空間擴展：
	允許應用程序使用比實際物理內存更多的地址空間。
2. 內存保護：
	每個進程擁有獨立的虛擬地址空間，防止進程之間的內存干擾和非法訪問。
3. 內存管理：
	提供內存分配和回收機制，優化內存使用效率。
### 偽作業技術（Spooling Technology）
Spooling（Simultaneous Peripheral Operations On-Line）是一種將I/O操作排隊並批處理的技術，用於提高I/O設備（如打印機、磁帶機、磁碟機等）的利用率和效率。Spooling技術通過將I/O請求暫存到磁盤等中間存儲設備，實現I/O操作與CPU處理的並行執行。